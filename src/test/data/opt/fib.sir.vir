module fib

export function w $fib_rec(w %n) {
@9:
  %0 = le.w %n, 0x1_w ; @10
  br %0, @8, @2
@2:
  %n1 = sub.w %n, 0x1_w ; @7
  %n2 = sub.w %n, 0x2_w ; @6
  %a1 = call.w $fib_rec(%n1) ; @5
  %a2 = call.w $fib_rec(%n2) ; @4
  %r = add.w %a1, %a2 ; @3
  ret %r
@8:
  ret %n
}

export function w $fib_iter(w %n) {
@25:
  %1 = le.w %n, 0x1_w ; @26
  br %1, @24, @20
@11:
  jmp @18
@12:
  ret %c
@13:
  %x = add.w %p, %c ; @17
  %p = copy.w %c ; @16
  %c = copy.w %x ; @15
  %i = add.w %i, 0x1_w ; @14
  jmp @11
@18:
  %2 = le.w %i, %n ; @19
  br %2, @13, @12
@20:
  %p = copy.w 0x0_w ; @23
  %c = copy.w 0x1_w ; @22
  %i = copy.w 0x2_w ; @21
  jmp @11
@24:
  ret %n
}
