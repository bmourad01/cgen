module gcdext

export function $gcd(w %a/rdi, w %b/rsi) {
  %31 = slot 8, align 8
  %32 = slot 8, align 8
@2:
  %1.1 = eq.w %a, 0x0_w ; @30
  br %1.1, @3, @4
@3:
  st.w %b, %31 ; @6
  %33.1 = add.l %31, 0x4_l ; @61
  st.w 0x0_w, %33.1 ; @8
  st.w 0x1_w, %32 ; @10
  %19.1 = ld.l %31 ; @49
  %21.1 = ld.l %32 ; @52
  jmp @29(%21.1, %19.1)
@4:
  %m.1 = rem.w %b, %a ; @12
  %27.1/l/rax, %28.1/l/rdx = call $gcd(%m.1/rdi, %a/rsi) ; @13
  st.l %27.1, %31 ; @38
  st.l %28.1, %32 ; @42
  %rg.1 = ld.w %31 ; @15
  %34.1 = add.l %31, 0x4_l ; @62
  %rx.1 = ld.w %34.1 ; @17
  %ry.1 = ld.w %32 ; @19
  st.w %rg.1, %31 ; @20
  %nx.1 = div.w %b, %a ; @21
  %6.1 = mul.w %nx.1, %rx.1 ; @35
  %7.1 = sub.w %ry.1, %6.1 ; @36
  st.w %7.1, %34.1 ; @25
  st.w %rx.1, %32 ; @27
  %14.1 = ld.l %31 ; @43
  %16.1 = ld.l %32 ; @46
  jmp @29(%16.1, %14.1)
@29(%30.1, %29.1):
  ret rax/%29.1, rdx/%30.1
}
