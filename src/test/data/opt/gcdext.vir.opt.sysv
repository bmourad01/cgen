module gcdext

export function $gcd(w %a/rdi, w %b/rsi) {
  %res = slot 16, align 8
  %r = slot 16, align 8
@2:
  %1.1 = eq.w %a, 0x0_w ; @30
  %2.1 = add.l %res, 0x8_l ; @31
  %3.1 = add.l %res, 0x4_l ; @32
  br %1.1, @3, @4
@3:
  st.w %b, %res ; @6
  st.w 0x0_w, %3.1 ; @8
  st.w 0x1_w, %2.1 ; @10
  %19.1 = ld.l %res ; @49
  %21.1 = ld.l %2.1 ; @52
  jmp @29(%21.1, %19.1)
@4:
  %m.1 = rem.w %b, %a ; @12
  %27.1/l/rax, %28.1/l/rdx = call $gcd(%m.1/rdi, %a/rsi) ; @13
  st.l %27.1, %r ; @38
  %12.1 = add.l %r, 0x8_l ; @41
  st.l %28.1, %12.1 ; @42
  %rg.1 = ld.w %r ; @15
  %4.1 = add.l %r, 0x4_l ; @33
  %rx.1 = ld.w %4.1 ; @17
  %ry.1 = ld.w %12.1 ; @19
  st.w %rg.1, %res ; @20
  %nx.1 = div.w %b, %a ; @21
  %6.1 = mul.w %nx.1, %rx.1 ; @35
  %7.1 = sub.w %ry.1, %6.1 ; @36
  st.w %7.1, %3.1 ; @25
  st.w %rx.1, %2.1 ; @27
  %14.1 = ld.l %res ; @43
  %16.1 = ld.l %2.1 ; @46
  jmp @29(%16.1, %14.1)
@29(%30.1, %29.1):
  ret rax/%29.1, rdx/%30.1
}
