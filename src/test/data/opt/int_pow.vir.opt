module int_pow

export function l $int_pow(l %base, l %exponent) {
@2:
  jmp @3(0x1_l, 0x1_l, %base, %exponent)
@3(%ret.2, %mul3.2, %mul1.2, %exponent.1):
  %0 = ne.l %exponent.1, 0x0_l ; @55
  br %0, @9, @10
@9:
  %1 = mul.l %mul1.2, %mul3.2 ; @56
  %2 = mul.l %1, %1 ; @57
  %3 = mul.l %2, %1 ; @58
  %4 = and.l %exponent.1, 0x3_l ; @59
  switch.l %4, @21(%ret.2) [0x1_l -> @14,
                            0x2_l -> @15,
                            0x3_l -> @16]
@14:
  %6 = mul.l %ret.2, %1 ; @61
  jmp @21(%6)
@15:
  %7 = mul.l %ret.2, %1 ; @62
  %8 = mul.l %7, %1 ; @63
  jmp @21(%8)
@16:
  %9 = mul.l %ret.2, %1 ; @64
  %10 = mul.l %9, %2 ; @65
  jmp @21(%10)
@21(%ret.3):
  %5 = asr.l %exponent.1, 0x2_l ; @60
  jmp @3(%ret.3, %3, %1, %5)
@10:
  ret %ret.2
}

export function l $int_pow_alt(l %base, l %exponent) {
  %mul = slot 32, align 8
@27:
  st.l 0x1_l, %mul ; @30
  %12 = add.l %mul, 0x8_l ; @67
  st.l %base, %12 ; @32
  %13 = add.l %mul, 0x18_l ; @68
  st.l 0x1_l, %13 ; @34
  %14 = add.l %mul, 0x10_l ; @69
  jmp @28(0x1_l, %exponent)
@28(%ret.2, %exponent.1):
  %15 = ne.l %exponent.1, 0x0_l ; @70
  br %15, @35, @36
@35:
  %mul1.1 = ld.l %12 ; @41
  %mul3.1 = ld.l %13 ; @42
  %16 = mul.l %mul1.1, %mul3.1 ; @71
  st.l %16, %12 ; @44
  %17 = mul.l %16, %16 ; @72
  st.l %17, %14 ; @46
  %18 = mul.l %17, %16 ; @73
  st.l %18, %13 ; @48
  %19 = and.l %exponent.1, 0x3_l ; @74
  %20 = lsl.l %19, 0x3_l ; @75
  %21 = add.l %mul, %20 ; @76
  %mule.1 = ld.l %21 ; @52
  %22 = mul.l %ret.2, %mule.1 ; @77
  %23 = asr.l %exponent.1, 0x2_l ; @78
  jmp @28(%22, %23)
@36:
  ret %ret.2
}
